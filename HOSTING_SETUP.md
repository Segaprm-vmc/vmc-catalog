# Настройка хостинга для VMC каталога

## Проблема решена ✅

Ранее была проблема: модели добавлялись, но не сохранялись. Система возвращала "модель добавлена", но данные пропадали.

**Причина:** PHP скрипт `save-models.php` только возвращал сообщение об успехе, но не сохранял данные.

**Решение:** Переписали полноценную систему хранения с резервным копированием.

## Требования к серверу

### 1. Права доступа к файлам

Убедитесь что папка `/public/data/` имеет права на запись:

```bash
chmod 755 /path/to/vmc-catalog/public/data/
chmod 666 /path/to/vmc-catalog/public/data/models.json
```

### 2. PHP настройки

Проверьте настройки PHP:

```ini
; Включить отображение ошибок для разработки
display_errors = On
error_reporting = E_ALL

; Размер данных POST
post_max_size = 50M
upload_max_filesize = 50M

; Время выполнения скриптов
max_execution_time = 300
```

### 3. Структура файлов на сервере

```
public/
├── api/
│   ├── save-models.php    # ✅ Обновлен - полноценное сохранение
│   └── load-models.php    # ✅ Обновлен - с обработкой ошибок
├── data/
│   ├── models.json        # Основной файл с моделями
│   └── models.backup.json # Автоматический бэкап
└── ...
```

## Новые возможности

### Автоматическое резервное копирование
- Перед каждым сохранением создается бэкап
- Файл `models.backup.json` содержит предыдущую версию

### Обработка ошибок
- Валидация JSON данных
- Проверка прав доступа к файлам
- Логирование ошибок в PHP error log

### Генерация ID
- Автоматическая генерация уникальных ID для новых моделей
- Формат: `model_[uniqid]_[timestamp]`

### Управление порядком
- Автоматическая установка порядка для новых моделей
- Сортировка по полю `order` при загрузке

## Как проверить что все работает

### 1. Проверка прав доступа

```bash
# На сервере выполните:
ls -la /path/to/vmc-catalog/public/data/

# Должно быть примерно так:
# -rw-rw-rw- 1 www-data www-data models.json
# drwxrwxr-x 2 www-data www-data data/
```

### 2. Проверка работы API

Откройте в браузере:
- `https://your-domain.com/api/health-check.php` - диагностика системы ✨
- `https://your-domain.com/api/load-models.php` - должен вернуть JSON с моделями
- Проверьте browser console на наличие ошибок

### 3. Тест добавления модели

1. Перейдите в админку: `https://your-domain.com/admin`
2. Введите пароль: `admin123`
3. Нажмите "Управление моделями"
4. Добавьте тестовую модель
5. Проверьте что модель появилась в списке
6. Обновите страницу - модель должна остаться

## Логи и отладка

### Проверка PHP логов

```bash
# Найдите файл логов PHP
tail -f /var/log/php/error.log

# Или в зависимости от конфигурации:
tail -f /var/log/apache2/error.log
tail -f /var/log/nginx/error.log
```

### Включить подробное логирование

В `save-models.php` и `load-models.php` добавлено логирование ошибок через `error_log()`.

### Проверка через браузер

Откройте Developer Tools (F12) и проверьте:
- **Network** - все ли API запросы успешны (200)
- **Console** - нет ли JavaScript ошибок

## Бэкап и восстановление

### Ручной бэкап

```bash
# Создать резервную копию
cp /path/to/vmc-catalog/public/data/models.json \
   /path/to/backups/models_$(date +%Y%m%d_%H%M%S).json
```

### Восстановление из бэкапа

```bash
# Восстановить из автоматического бэкапа
cp /path/to/vmc-catalog/public/data/models.backup.json \
   /path/to/vmc-catalog/public/data/models.json
```

## Типичные проблемы

### Модели не сохраняются
- ✅ **Решено**: Переписали `save-models.php`
- Проверьте права доступа к папке `data/`
- Проверьте PHP логи на ошибки

### Ошибка 500 Internal Server Error
- Проверьте синтаксис PHP файлов
- Проверьте права доступа
- Посмотрите error log сервера

### JSON parse error
- Проверьте кодировку файла `models.json` (должна быть UTF-8)
- Проверьте валидность JSON через онлайн валидатор

## Контакты

Если проблемы остаются:
1. Проверьте PHP логи
2. Убедитесь в правах доступа к файлам
3. Проверьте Network tab в браузере
4. Отправьте логи для анализа 